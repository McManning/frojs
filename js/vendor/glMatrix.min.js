/* 
 * glMatrix.js - High performance matrix and vector operations for WebGL
 * version 0.9.6
 */
 
/*
 * Copyright (c) 2011 Brandon Jones
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not
 *    be misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */
glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;var rect={};rect.create=function(t){var r=new glMatrixArrayType(4);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r},rect.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},rect.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},rect.x2=function(t){return t[0]+t[2]},rect.y2=function(t){return t[1]+t[3]},rect.intersects=function(t,r){return!(r[0]>t[0]+t[2]||r[0]+r[2]<t[0]||r[1]>t[1]+t[3]||r[1]+r[3]<t[1])},rect.intersection=function(t,r,n){n||(n=t);var a,e;return a=Math.max(t[0],r[0]),e=Math.max(t[1],r[1]),n[2]=Math.min(t[0]+t[2],r[0]+r[2])-a,n[3]=Math.min(t[1]+t[3],r[1]+r[3])-e,n};var vec3={};vec3.create=function(t){var r=new glMatrixArrayType(3);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r},vec3.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},vec3.equals=function(t,r){return t[0]==r[0]&&t[1]==r[1]&&t[2]==r[2]},vec3.add=function(t,r,n){return n&&t!=n?(n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n):(t[0]+=r[0],t[1]+=r[1],t[2]+=r[2],t)},vec3.subtract=function(t,r,n){return n&&t!=n?(n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n):(t[0]-=r[0],t[1]-=r[1],t[2]-=r[2],t)},vec3.negate=function(t,r){return r||(r=t),r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r},vec3.scale=function(t,r,n){return n&&t!=n?(n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n):(t[0]*=r,t[1]*=r,t[2]*=r,t)},vec3.normalize=function(t,r){r||(r=t);var n=t[0],a=t[1],e=t[2],u=Math.sqrt(n*n+a*a+e*e);return u?1==u?(r[0]=n,r[1]=a,r[2]=e,r):(u=1/u,r[0]=n*u,r[1]=a*u,r[2]=e*u,r):(r[0]=0,r[1]=0,r[2]=0,r)},vec3.cross=function(t,r,n){n||(n=t);var a=t[0],e=t[1],u=t[2],c=r[0],i=r[1],o=r[2];return n[0]=e*o-u*i,n[1]=u*c-a*o,n[2]=a*i-e*c,n},vec3.length=function(t){var r=t[0],n=t[1],a=t[2];return Math.sqrt(r*r+n*n+a*a)},vec3.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},vec3.direction=function(t,r,n){n||(n=t);var a=t[0]-r[0],e=t[1]-r[1],u=t[2]-r[2],c=Math.sqrt(a*a+e*e+u*u);return c?(c=1/c,n[0]=a*c,n[1]=e*c,n[2]=u*c,n):(n[0]=0,n[1]=0,n[2]=0,n)},vec3.lerp=function(t,r,n,a){return a||(a=t),a[0]=t[0]+n*(r[0]-t[0]),a[1]=t[1]+n*(r[1]-t[1]),a[2]=t[2]+n*(r[2]-t[2]),a},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"};var mat3={};mat3.create=function(t){var r=new glMatrixArrayType(9);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8]),r},mat3.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,r){if(!r||t==r){var n=t[1],a=t[2],e=t[5];return t[1]=t[3],t[2]=t[6],t[3]=n,t[5]=t[7],t[6]=a,t[7]=e,t}return r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8],r},mat3.toMat4=function(t,r){return r||(r=mat4.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=0,r[4]=t[3],r[5]=t[4],r[6]=t[5],r[7]=0,r[8]=t[6],r[9]=t[7],r[10]=t[8],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"};var mat4={};mat4.create=function(t){var r=new glMatrixArrayType(16);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},mat4.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,r){if(!r||t==r){var n=t[1],a=t[2],e=t[3],u=t[6],c=t[7],i=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=n,t[6]=t[9],t[7]=t[13],t[8]=a,t[9]=u,t[11]=t[14],t[12]=e,t[13]=c,t[14]=i,t}return r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15],r},mat4.determinant=function(t){var r=t[0],n=t[1],a=t[2],e=t[3],u=t[4],c=t[5],i=t[6],o=t[7],f=t[8],v=t[9],s=t[10],m=t[11],M=t[12],l=t[13],h=t[14],y=t[15];return M*v*i*e-f*l*i*e-M*c*s*e+u*l*s*e+f*c*h*e-u*v*h*e-M*v*a*o+f*l*a*o+M*n*s*o-r*l*s*o-f*n*h*o+r*v*h*o+M*c*a*m-u*l*a*m-M*n*i*m+r*l*i*m+u*n*h*m-r*c*h*m-f*c*a*y+u*v*a*y+f*n*i*y-r*v*i*y-u*n*s*y+r*c*s*y},mat4.inverse=function(t,r){r||(r=t);var n=t[0],a=t[1],e=t[2],u=t[3],c=t[4],i=t[5],o=t[6],f=t[7],v=t[8],s=t[9],m=t[10],M=t[11],l=t[12],h=t[13],y=t[14],q=t[15],p=n*i-a*c,d=n*o-e*c,A=n*f-u*c,g=a*o-e*i,x=a*f-u*i,b=e*f-u*o,T=v*h-s*l,w=v*y-m*l,F=v*q-M*l,V=s*y-m*h,W=s*q-M*h,z=m*q-M*y,G=1/(p*z-d*W+A*V+g*F-x*w+b*T);return r[0]=(i*z-o*W+f*V)*G,r[1]=(-a*z+e*W-u*V)*G,r[2]=(h*b-y*x+q*g)*G,r[3]=(-s*b+m*x-M*g)*G,r[4]=(-c*z+o*F-f*w)*G,r[5]=(n*z-e*F+u*w)*G,r[6]=(-l*b+y*A-q*d)*G,r[7]=(v*b-m*A+M*d)*G,r[8]=(c*W-i*F+f*T)*G,r[9]=(-n*W+a*F-u*T)*G,r[10]=(l*x-h*A+q*p)*G,r[11]=(-v*x+s*A-M*p)*G,r[12]=(-c*V+i*w-o*T)*G,r[13]=(n*V-a*w+e*T)*G,r[14]=(-l*g+h*d-y*p)*G,r[15]=(v*g-s*d+m*p)*G,r},mat4.toRotationMat=function(t,r){return r||(r=mat4.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},mat4.toMat3=function(t,r){return r||(r=mat3.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r},mat4.toInverseMat3=function(t,r){var n=t[0],a=t[1],e=t[2],u=t[4],c=t[5],i=t[6],o=t[8],f=t[9],v=t[10],s=v*c-i*f,m=-v*u+i*o,M=f*u-c*o,l=n*s+a*m+e*M;if(!l)return null;var h=1/l;return r||(r=mat3.create()),r[0]=s*h,r[1]=(-v*a+e*f)*h,r[2]=(i*a-e*c)*h,r[3]=m*h,r[4]=(v*n-e*o)*h,r[5]=(-i*n+e*u)*h,r[6]=M*h,r[7]=(-f*n+a*o)*h,r[8]=(c*n-a*u)*h,r},mat4.multiply=function(t,r,n){n||(n=t);var a=t[0],e=t[1],u=t[2],c=t[3],i=t[4],o=t[5],f=t[6],v=t[7],s=t[8],m=t[9],M=t[10],l=t[11],h=t[12],y=t[13],q=t[14],p=t[15],d=r[0],A=r[1],g=r[2],x=r[3],b=r[4],T=r[5],w=r[6],F=r[7],V=r[8],W=r[9],z=r[10],G=r[11],I=r[12],L=r[13],k=r[14],P=r[15];return n[0]=d*a+A*i+g*s+x*h,n[1]=d*e+A*o+g*m+x*y,n[2]=d*u+A*f+g*M+x*q,n[3]=d*c+A*v+g*l+x*p,n[4]=b*a+T*i+w*s+F*h,n[5]=b*e+T*o+w*m+F*y,n[6]=b*u+T*f+w*M+F*q,n[7]=b*c+T*v+w*l+F*p,n[8]=V*a+W*i+z*s+G*h,n[9]=V*e+W*o+z*m+G*y,n[10]=V*u+W*f+z*M+G*q,n[11]=V*c+W*v+z*l+G*p,n[12]=I*a+L*i+k*s+P*h,n[13]=I*e+L*o+k*m+P*y,n[14]=I*u+L*f+k*M+P*q,n[15]=I*c+L*v+k*l+P*p,n},mat4.multiplyVec3=function(t,r,n){n||(n=r);var a=r[0],e=r[1],u=r[2];return n[0]=t[0]*a+t[4]*e+t[8]*u+t[12],n[1]=t[1]*a+t[5]*e+t[9]*u+t[13],n[2]=t[2]*a+t[6]*e+t[10]*u+t[14],n},mat4.multiplyVec4=function(t,r,n){n||(n=r);var a=r[0],e=r[1],u=r[2],c=r[3];return n[0]=t[0]*a+t[4]*e+t[8]*u+t[12]*c,n[1]=t[1]*a+t[5]*e+t[9]*u+t[13]*c,n[2]=t[2]*a+t[6]*e+t[10]*u+t[14]*c,n[3]=t[3]*a+t[7]*e+t[11]*u+t[15]*c,n},mat4.translate=function(t,r,n){var a=r[0],e=r[1],u=r[2];if(!n||t==n)return t[12]=t[0]*a+t[4]*e+t[8]*u+t[12],t[13]=t[1]*a+t[5]*e+t[9]*u+t[13],t[14]=t[2]*a+t[6]*e+t[10]*u+t[14],t[15]=t[3]*a+t[7]*e+t[11]*u+t[15],t;var c=t[0],i=t[1],o=t[2],f=t[3],v=t[4],s=t[5],m=t[6],M=t[7],l=t[8],h=t[9],y=t[10],q=t[11];return n[0]=c,n[1]=i,n[2]=o,n[3]=f,n[4]=v,n[5]=s,n[6]=m,n[7]=M,n[8]=l,n[9]=h,n[10]=y,n[11]=q,n[12]=c*a+v*e+l*u+t[12],n[13]=i*a+s*e+h*u+t[13],n[14]=o*a+m*e+y*u+t[14],n[15]=f*a+M*e+q*u+t[15],n},mat4.scale=function(t,r,n){var a=r[0],e=r[1],u=r[2];return n&&t!=n?(n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*e,n[5]=t[5]*e,n[6]=t[6]*e,n[7]=t[7]*e,n[8]=t[8]*u,n[9]=t[9]*u,n[10]=t[10]*u,n[11]=t[11]*u,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):(t[0]*=a,t[1]*=a,t[2]*=a,t[3]*=a,t[4]*=e,t[5]*=e,t[6]*=e,t[7]*=e,t[8]*=u,t[9]*=u,t[10]*=u,t[11]*=u,t)},mat4.rotate=function(t,r,n,a){var e=n[0],u=n[1],c=n[2],i=Math.sqrt(e*e+u*u+c*c);if(!i)return null;1!=i&&(i=1/i,e*=i,u*=i,c*=i);var o=Math.sin(r),f=Math.cos(r),v=1-f,s=t[0],m=t[1],M=t[2],l=t[3],h=t[4],y=t[5],q=t[6],p=t[7],d=t[8],A=t[9],g=t[10],x=t[11],b=e*e*v+f,T=u*e*v+c*o,w=c*e*v-u*o,F=e*u*v-c*o,V=u*u*v+f,W=c*u*v+e*o,z=e*c*v+u*o,G=u*c*v-e*o,I=c*c*v+f;return a?t!=a&&(a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]):a=t,a[0]=s*b+h*T+d*w,a[1]=m*b+y*T+A*w,a[2]=M*b+q*T+g*w,a[3]=l*b+p*T+x*w,a[4]=s*F+h*V+d*W,a[5]=m*F+y*V+A*W,a[6]=M*F+q*V+g*W,a[7]=l*F+p*V+x*W,a[8]=s*z+h*G+d*I,a[9]=m*z+y*G+A*I,a[10]=M*z+q*G+g*I,a[11]=l*z+p*G+x*I,a},mat4.rotateX=function(t,r,n){var a=Math.sin(r),e=Math.cos(r),u=t[4],c=t[5],i=t[6],o=t[7],f=t[8],v=t[9],s=t[10],m=t[11];return n?t!=n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[4]=u*e+f*a,n[5]=c*e+v*a,n[6]=i*e+s*a,n[7]=o*e+m*a,n[8]=u*-a+f*e,n[9]=c*-a+v*e,n[10]=i*-a+s*e,n[11]=o*-a+m*e,n},mat4.rotateY=function(t,r,n){var a=Math.sin(r),e=Math.cos(r),u=t[0],c=t[1],i=t[2],o=t[3],f=t[8],v=t[9],s=t[10],m=t[11];return n?t!=n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*e+f*-a,n[1]=c*e+v*-a,n[2]=i*e+s*-a,n[3]=o*e+m*-a,n[8]=u*a+f*e,n[9]=c*a+v*e,n[10]=i*a+s*e,n[11]=o*a+m*e,n},mat4.rotateZ=function(t,r,n){var a=Math.sin(r),e=Math.cos(r),u=t[0],c=t[1],i=t[2],o=t[3],f=t[4],v=t[5],s=t[6],m=t[7];return n?t!=n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*e+f*a,n[1]=c*e+v*a,n[2]=i*e+s*a,n[3]=o*e+m*a,n[4]=u*-a+f*e,n[5]=c*-a+v*e,n[6]=i*-a+s*e,n[7]=o*-a+m*e,n},mat4.frustum=function(t,r,n,a,e,u,c){c||(c=mat4.create());var i=r-t,o=a-n,f=u-e;return c[0]=2*e/i,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*e/o,c[6]=0,c[7]=0,c[8]=(r+t)/i,c[9]=(a+n)/o,c[10]=-(u+e)/f,c[11]=-1,c[12]=0,c[13]=0,c[14]=-(u*e*2)/f,c[15]=0,c},mat4.perspective=function(t,r,n,a,e){var u=n*Math.tan(t*Math.PI/360),c=u*r;return mat4.frustum(-c,c,-u,u,n,a,e)},mat4.ortho=function(t,r,n,a,e,u,c){c||(c=mat4.create());var i=r-t,o=a-n,f=u-e;return c[0]=2/i,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2/o,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=-2/f,c[11]=0,c[12]=-(t+r)/i,c[13]=-(a+n)/o,c[14]=-(u+e)/f,c[15]=1,c},mat4.lookAt=function(t,r,n,a){a||(a=mat4.create());var e=t[0],u=t[1],c=t[2],i=n[0],o=n[1],f=n[2],v=r[0],s=r[1],m=r[2];if(e==v&&u==s&&c==m)return mat4.identity(a);var M,l,h,y,q,p,d,A,g,x;return M=e-r[0],l=u-r[1],h=c-r[2],x=1/Math.sqrt(M*M+l*l+h*h),M*=x,l*=x,h*=x,y=o*h-f*l,q=f*M-i*h,p=i*l-o*M,x=Math.sqrt(y*y+q*q+p*p),x?(x=1/x,y*=x,q*=x,p*=x):(y=0,q=0,p=0),d=l*p-h*q,A=h*y-M*p,g=M*q-l*y,x=Math.sqrt(d*d+A*A+g*g),x?(x=1/x,d*=x,A*=x,g*=x):(d=0,A=0,g=0),a[0]=y,a[1]=d,a[2]=M,a[3]=0,a[4]=q,a[5]=A,a[6]=l,a[7]=0,a[8]=p,a[9]=g,a[10]=h,a[11]=0,a[12]=-(y*e+q*u+p*c),a[13]=-(d*e+A*u+g*c),a[14]=-(M*e+l*u+h*c),a[15]=1,a},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4={},quat4.create=function(t){var r=new glMatrixArrayType(4);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r},quat4.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},quat4.calculateW=function(t,r){var n=t[0],a=t[1],e=t[2];return r&&t!=r?(r[0]=n,r[1]=a,r[2]=e,r[3]=-Math.sqrt(Math.abs(1-n*n-a*a-e*e)),r):(t[3]=-Math.sqrt(Math.abs(1-n*n-a*a-e*e)),t)},quat4.inverse=function(t,r){return r&&t!=r?(r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var r=t[0],n=t[1],a=t[2],e=t[3];return Math.sqrt(r*r+n*n+a*a+e*e)},quat4.normalize=function(t,r){r||(r=t);var n=t[0],a=t[1],e=t[2],u=t[3],c=Math.sqrt(n*n+a*a+e*e+u*u);return 0==c?(r[0]=0,r[1]=0,r[2]=0,r[3]=0,r):(c=1/c,r[0]=n*c,r[1]=a*c,r[2]=e*c,r[3]=u*c,r)},quat4.multiply=function(t,r,n){n||(n=t);var a=t[0],e=t[1],u=t[2],c=t[3],i=r[0],o=r[1],f=r[2],v=r[3];return n[0]=a*v+c*i+e*f-u*o,n[1]=e*v+c*o+u*i-a*f,n[2]=u*v+c*f+a*o-e*i,n[3]=c*v-a*i-e*o-u*f,n},quat4.multiplyVec3=function(t,r,n){n||(n=r);var a=r[0],e=r[1],u=r[2],c=t[0],i=t[1],o=t[2],f=t[3],v=f*a+i*u-o*e,s=f*e+o*a-c*u,m=f*u+c*e-i*a,M=-c*a-i*e-o*u;return n[0]=v*f+M*-c+s*-o-m*-i,n[1]=s*f+M*-i+m*-c-v*-o,n[2]=m*f+M*-o+v*-i-s*-c,n},quat4.toMat3=function(t,r){r||(r=mat3.create());var n=t[0],a=t[1],e=t[2],u=t[3],c=n+n,i=a+a,o=e+e,f=n*c,v=n*i,s=n*o,m=a*i,M=a*o,l=e*o,h=u*c,y=u*i,q=u*o;return r[0]=1-(m+l),r[1]=v-q,r[2]=s+y,r[3]=v+q,r[4]=1-(f+l),r[5]=M-h,r[6]=s-y,r[7]=M+h,r[8]=1-(f+m),r},quat4.toMat4=function(t,r){r||(r=mat4.create());var n=t[0],a=t[1],e=t[2],u=t[3],c=n+n,i=a+a,o=e+e,f=n*c,v=n*i,s=n*o,m=a*i,M=a*o,l=e*o,h=u*c,y=u*i,q=u*o;return r[0]=1-(m+l),r[1]=v-q,r[2]=s+y,r[3]=0,r[4]=v+q,r[5]=1-(f+l),r[6]=M-h,r[7]=0,r[8]=s-y,r[9]=M+h,r[10]=1-(f+m),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},quat4.slerp=function(t,r,n,a){a||(a=t);var e=t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3];if(Math.abs(e)>=1)return a!=t&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]),a;var u=Math.acos(e),c=Math.sqrt(1-e*e);if(Math.abs(c)<.001)return a[0]=.5*t[0]+.5*r[0],a[1]=.5*t[1]+.5*r[1],a[2]=.5*t[2]+.5*r[2],a[3]=.5*t[3]+.5*r[3],a;var i=Math.sin((1-n)*u)/c,o=Math.sin(n*u)/c;return a[0]=t[0]*i+r[0]*o,a[1]=t[1]*i+r[1]*o,a[2]=t[2]*i+r[2]*o,a[3]=t[3]*i+r[3]*o,a},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};